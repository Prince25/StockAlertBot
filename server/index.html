<!DOCTYPE html>
<html>
	<head>
		<!--
            Designed and coded by:
            Prabhjot "Prince" Singh
            https://github.com/Prince25/StockAlertBot
        -->
		<title>StockAlertBot Settings</title>

		<!--  Axios CDN  -->
		<script src="https://unpkg.com/axios/dist/axios.min.js"></script>

		<!--  Vue.js CDN  -->
		<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>

		<!--  Vuetify.js CDN  -->
		<script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
		<link
			href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css"
			rel="stylesheet"
		/>
		<link
			href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900"
			rel="stylesheet"
		/>
		<link
			href="https://cdn.jsdelivr.net/npm/@mdi/font@4.x/css/materialdesignicons.min.css"
			rel="stylesheet"
		/>
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui"
		/>
	</head>

	<body>
		<style>
			/* Hide up and down arrows on phone number inputs */
			.phoneNumber input[type="number"] {
				-moz-appearance: textfield;
			}
			.phoneNumber input::-webkit-outer-spin-button,
			.phoneNumber input::-webkit-inner-spin-button {
				-webkit-appearance: none;
			}
		</style>

		<div id="app">
			<v-app>
				<v-main>
					<v-container>
						<p class="text-h4 font-weight-medium text-center">StockAlertBot SETTINGS</p>
						<v-divider></v-divider>

						<v-tabs v-model="current_tab" fixed-tabs>
							<v-tab v-for="tab in tabs" :key="tab"> {{ tab }} </v-tab>

							<!--  URL Tab  -->
							<v-tab-item>
								<v-divider class="mb-4"></v-divider>
								<url-list
									v-bind:urls="userSettings.URLS"
									v-on:remove_url="removeURL"
									v-on:add_url="addURL"
								/>
							</v-tab-item>

							<!--  Settings Tab  -->
							<v-tab-item>
								<v-divider class="mb-4"></v-divider>
								<settings
									v-bind:user_settings="userSettings"
									v-bind:store_names="getStoreNames"
									v-bind:has_amazon="has_amazon"
									v-bind:has_target="has_target"
									v-on:update_interval="updateInterval"
									v-on:update_delay="updateDelay"
									v-on:update_open_url="updateOpenURL"
									v-on:update_desktop="updateDesktop"
									v-on:update_proxies="updateProxies"
									v-on:update_store_intervals="updateStoreIntervals"
									v-on:update_amazon_merchant="updateAmazonMerchant"
									v-on:update_target="updateTarget"
								/>
							</v-tab-item>

							<!--  Optional Tab  -->
							<v-tab-item>
								<v-divider class="mb-4"></v-divider>
								<optional
									v-bind:user_settings="userSettings"
									v-bind:env_settings="envSettings"
									v-on:toggle_email="setEmail"
									v-on:remove_webhook_url="removeWebhookURL"
									v-on:add_webhook_url="addWebhookURL"
									v-on:update_email_service="updateEmailService"
									v-on:update_email_from="updateEmailFrom"
									v-on:update_email_pass="updateEmailPass"
									v-on:update_email_to="updateEmailTo"
									v-on:update_sms_method="updateSMSMethod"
									v-on:update_sms_aws_region="updateAWSRegion"
									v-on:update_sms_aws_key="updateAWSKey"
									v-on:update_sms_aws_secret="updateAWSSecret"
									v-on:update_sms_aws_phone="updateAWSPhone"
									v-on:update_sms_email_service="updateSMSEmailService"
									v-on:update_sms_email_from="updateSMSEmailFrom"
									v-on:update_sms_email_pass="updateSMSEmailPass"
									v-on:update_sms_email_carrier="updateSMSEmailCarrier"
									v-on:update_sms_email_phone="updateSMSEmailPhone"
									v-on:update_sms_twilio_sid="updateSMSTwilioSID"
									v-on:update_sms_twilio_auth="updateSMSTwilioAuth"
									v-on:update_sms_twilio_from="updateSMSTwilioFrom"
									v-on:update_sms_twilio_to="updateSMSTwilioTo"
								/>
							</v-tab-item>

							<!--  Debug Tab  -->
							<v-tab-item>
								<v-divider class="mb-4"></v-divider>
								<p v-for="(settings,key) in userSettings">{{key}}:{{settings}}</p>
								<p v-for="(settings,key) in envSettings">{{key}}:{{settings}}</p>
								<p>has_amazon: {{has_amazon}}</p>
								<p>has_target: {{has_target}}</p>
								<p>stores: {{[...stores]}}</p>
							</v-tab-item>
						</v-tabs>

						<v-divider class="mt-4 mb-4"></v-divider>

						<!--  Save Button  -->
						<div style="text-align: center">
							<v-btn
								elevation="4"
								outlined
								v-on:click="sendSettings"
								:disabled="checkSaveButton"
							>
								Save Settings
								<v-icon right dark>mdi-content-save</v-icon>
							</v-btn>
							<p class="pa-0 ma-0 mt-2" style="color: red" id="save_button_error"></p>
						</div>
					</v-container>
				</v-main>
			</v-app>
		</div>

		<script>
			/*
                URL Components
                url-list, url-item, add-url
            */
			Vue.component("url-list", {
				props: ["urls"],
				template: `<div>
                                <v-row dense>
                                    <v-col v-for="(url, index) in urls" :key="index" md="6" class="ma-0 pa-3 pl-8 pr-8">
                                        <url-item v-bind:url="url" v-bind:key="url" v-on:remove_url="$emit('remove_url', $event)" />
                                    </v-col>
                                </v-row>
                                <v-divider inset class="ma-7 mb-0"></v-divider>
                                <add-url class="ma-0 pa-3" v-on:add_url="$emit('add_url', $event)" />
                            </div>`,
			});

			Vue.component("url-item", {
				props: ["url"],
				methods: {
					remove() {
						this.$emit("remove_url", this.url);
					},
				},
				template: `<v-text-field
                                dense
                                solo
                                readonly
                                type="text"
                                hide-details
                                :value="url"
                                :append-outer-icon="'mdi-close'"
                                @click:append-outer="remove"
                            ></v-text-field>`,
			});

			Vue.component("add-url", {
				data: function () {
					return {
						url: "",
					};
				},
				methods: {
					add() {
						if (this.url) {
							this.$emit("add_url", this.url);
							this.url = "";
						}
					},
				},
				template: `<div>
                                <p style="font-size: 1.075rem!important;" class="text-button ma-0 text-center">Add URL</p>
                                <div class="ma-0 pa-0" style="max-width: 65%; display: flex; align-items: baseline;margin: auto !important;">
                                    <v-text-field
                                        dense
                                        solo
                                        outlined
                                        clearable
                                        hide-details
                                        clear-icon="mdi-close-circle"
                                        type="text"
                                        label="Enter URL"
                                        v-model="url"
                                        :append-outer-icon="'mdi-plus'"
                                        @click:append-outer="add"
										@keydown.enter="add"
                                    ></v-text-field>
                                    <v-tooltip bottom>
                                        <template v-slot:activator="{ on, attrs }">
                                            <v-btn class="ma-3 mb-9" color="primary" fab x-small v-bind="attrs" v-on="on">
                                                <v-icon dark>mdi-help</v-icon>
                                            </v-btn>
                                        </template>
                                        <span>Format: https://www.ABC123.com/...</span>
                                    </v-tooltip>
                                </div>
                                <p class="pa-0 ma-0" style="color: red; text-align: center;" id="add_url_error"></p>
                            </div>`,
			});

			/*
                Settings Component
                settings
            */
			Vue.component("settings", {
				props: ["user_settings", "store_names", "has_amazon", "has_target"],
				data: function () {
					return {
						// Interval variables
						interval_value: this.user_settings.INTERVAL.value,
						interval_value_rule: (value) =>
							parseInt(value) > 0 || "Must be more than 0",
						interval_unit: this.user_settings.INTERVAL.unit,
						interval_units: ["seconds", "minutes", "hours"],

						// Delay variables
						delay_value: this.user_settings.TIME_BETWEEN_CHECKS.value,
						delay_value_rule: (value) =>
							parseInt(value) >= 0 || "Must be more than or equal to 0",
						delay_unit: this.user_settings.TIME_BETWEEN_CHECKS.unit,
						delay_units: ["milliseconds", "seconds", "minutes", "hours"],

						// Boolean: Open URL, Desktop, Proxies
						open_url: this.user_settings.OPEN_URL,
						desktop_notification: this.user_settings.DESKTOP,
						proxies: this.user_settings.PROXIES,

						// Store Intervals
						store_intervals: [],

						// Amazon merchant
						amazon_merchant_id: "",
						custom_merchant_id: "",
						amazon_merchants: {
							None: "None",
							Canada: "A3DWYIK6Y9EEQB",
							France: "A1X6FK5RDHNB96",
							Italy: "A11IL2PNWYJU7H",
							Japan: "AN1VRQENFRJN5",
							Netherlands: "A3V701XPD7PSWM",
							Germany: "A3JWKAKR8XB7XF",
							Spain: "A1AT7YVPFBWXBL",
							"United Kingdom": "A3P5ROKL5A1OLE",
							"United States": "ATVPDKIKX0DER",
							Custom: "",
						},

						// Target Zip Code and API KEY
						target_zip: this.user_settings.TARGET_ZIP_CODE,
						target_key: this.user_settings.TARGET_KEY,
						target_zip_rule: (value) =>
							(parseInt(value) > 9999 && value.toString().length == 5) ||
							"Zip code must be postive and have length of 5",
					};
				},

				computed: {
					// Store Intervals
					updateStores: function () {
						this.store_intervals = [];
						const stores = Object.keys(this.user_settings.STORE_INTERVALS);
						this.store_names.forEach((store) => {
							if (this.user_settings.STORE_INTERVALS.hasOwnProperty(store)) {
								this.store_intervals.push({
									name: store,
									on: true,
									...this.user_settings.STORE_INTERVALS[store],
								});
							} else {
								this.store_intervals.push({
									name: store,
									on: false,
									...this.user_settings.INTERVAL,
								});
							}
						});
						return this.store_intervals;
					},
				},

				mounted() {
					// Amazon Merchants
					this.amazon_merchant_id = Object.keys(this.amazon_merchants).find(
						(key) =>
							this.amazon_merchants[key] === this.user_settings.AMAZON_MERCHANT_ID
					);
					if (!this.amazon_merchant_id) {
						this.amazon_merchant_id = "Custom";
						this.custom_merchant_id = this.user_settings.AMAZON_MERCHANT_ID;
					}
				},

				methods: {
					updateInterval() {
						if (this.interval_value > 0) {
							this.$emit("update_interval", {
								unit: this.interval_unit,
								value: parseInt(this.interval_value),
							});
						}
					},

					updateOpenURL() {
						this.$emit("update_open_url", this.open_url);
					},

					updateDesktop() {
						this.$emit("update_desktop", this.desktop_notification);
					},

					updateProxies() {
						this.$emit("update_proxies", this.proxies);
					},

					updateStoreIntervals() {
						this.$emit("update_store_intervals", this.store_intervals);
					},

					updateDelay() {
						if (this.interval_value >= 0) {
							this.$emit("update_delay", {
								unit: this.delay_unit,
								value: parseInt(this.delay_value),
							});
						}
					},

					updateAmazonMerchant() {
						let merchant_id;
						if (this.amazon_merchant_id === "Custom")
							merchant_id = this.custom_merchant_id;
						else merchant_id = this.amazon_merchants[this.amazon_merchant_id];
						this.$emit("update_amazon_merchant", merchant_id);
					},

					updateTarget() {
						if (
							this.target_zip > 9999 &&
							this.target_zip.toString().length == 5 &&
							this.target_key != ""
						)
							this.$emit("update_target", {
								zip: this.target_zip,
								key: this.target_key,
							});
					},

					resetTargetKey() {
						this.target_key = "ff457966e64d5e877fdbad070f276d18ecec4a01";
						this.updateTarget();
					},
				},

				template: `<div>
                                <v-row dense>

                                    <!--  Interval HTML  -->
                                    <v-col md="6" class="ma-0 pa-3 pl-8 pr-8">
                                        <div style="display: flex; align-items: center; justify-content: center;">
                                            <p class="text-overline mb-5" style="font-size: 1.1rem!important;">Default Interval</p>
                                            <div style="max-width: 15%" class="ml-4 mr-4">
                                                <v-text-field v-model="interval_value" single-line type="number" :rules="[interval_value_rule]" @change="updateInterval" dense solo />
                                            </div>
                                            <div style="max-width: 32%">
                                                <v-select :items="interval_units" v-model="interval_unit" @change="updateInterval" dense solo></v-select>
                                            </div>
                                            <v-tooltip bottom>
                                                <template v-slot:activator="{ on, attrs }">
                                                    <v-btn class="ma-3 mb-9" color="primary" fab x-small v-bind="attrs" v-on="on">
                                                        <v-icon dark>mdi-help</v-icon>
                                                    </v-btn>
                                                </template>
                                                <span>How often to check for products. Too often may be dangerous, especially for Amazon.</span>
                                            </v-tooltip>
                                        </div>

										<!--  Delay HTML  -->
										<div style="display: flex; align-items: center; justify-content: center;">
											<p class="text-overline mb-5" style="font-size: 1.1rem!important;">Spread out item checks</p>
											<div style="max-width: 15%" class="ml-4 mr-4">
                                                <v-text-field v-model="delay_value" single-line type="number" :rules="[delay_value_rule]" @change="updateDelay" dense solo />
                                            </div>
                                            <div style="max-width: 32%">
                                                <v-select :items="delay_units" v-model="delay_unit" @change="updateDelay" dense solo></v-select>
                                            </div>
											<v-tooltip bottom>
												<template v-slot:activator="{ on, attrs }">
													<v-btn class="ma-3 mb-9" color="primary" fab x-small v-bind="attrs" v-on="on">
														<v-icon dark>mdi-help</v-icon>
													</v-btn>
												</template>
												<span>Space out the checks between products for each store by this value.</span>
											</v-tooltip>
										</div>
                                    </v-col>

                                    <!--  Open URL, Desktop Notification HTML  -->
                                    <v-col md="6" class="ma-0 pa-3 pl-8 pr-8">
                                        <div style="display: flex; align-items: center; justify-content: center;">
                                            <v-checkbox class="mt-0" v-model="open_url" label="Open URL" @change="updateOpenURL" dense></v-checkbox>
                                            <v-tooltip bottom>
                                                <template v-slot:activator="{ on, attrs }">
                                                    <v-btn class="ma-3 mb-9" color="primary" fab x-small v-bind="attrs" v-on="on">
                                                        <v-icon dark>mdi-help</v-icon>
                                                    </v-btn>
                                                </template>
                                                <span>Opens the product url in your default browser when product is available.</span>
                                            </v-tooltip>

                                            <v-checkbox class="mt-0 ml-8 pl-8" v-model="desktop_notification" label="Desktop Notification" @change="updateDesktop"></v-checkbox>
                                            <v-tooltip bottom>
                                                <template v-slot:activator="{ on, attrs }">
                                                    <v-btn class="ma-3 mb-9" color="primary" fab x-small v-bind="attrs" v-on="on">
                                                        <v-icon dark>mdi-help</v-icon>
                                                    </v-btn>
                                                </template>
                                                <span>Sends a desktop notification.</span>
                                            </v-tooltip>

                                            <v-checkbox class="mt-0 ml-8 pl-8" v-model="proxies" label="Proxies" @change="updateProxies"></v-checkbox>
                                            <v-tooltip bottom>
                                                <template v-slot:activator="{ on, attrs }">
                                                    <v-btn class="ma-3 mb-9" color="primary" fab x-small v-bind="attrs" v-on="on">
                                                        <v-icon dark>mdi-help</v-icon>
                                                    </v-btn>
                                                </template>
                                                <span>Enable support for proxies.</span>
                                            </v-tooltip>
                                        </div>
                                        <p class="text-right red--text" v-if="proxies">Make sure to put proxies (one proxy per line) in the file, "config/proxies.txt".<br>
                                            Format: ip:port or username:password@ip:port.<br>
                                            Argos, Best Buy, Costco and Tesco do not currently work with proxies.</p>
                                    </v-col>
                                </v-row>

								<!--  Store Intervals HTML  -->
								<div v-if="store_names.length > 0">
                                    <v-divider inset></v-divider>
									<p style="font-size: 1.075rem!important;" class="text-button ma-0 mt-3 text-center">Interval Override</p>
                                    <div v-for="store in updateStores">
										<div style="display: flex; align-items: center; justify-content: center;">
											<p class="text-overline mb-0" style="font-size: 1.1rem!important;">{{store.name}} Interval</p>
											<v-switch class="ml-3" v-model="store.on" @change="updateStoreIntervals" inset></v-switch>

											<v-tooltip bottom>
												<template v-slot:activator="{ on, attrs }">
													<v-btn class="ml-3 mb-2" color="primary" fab x-small v-bind="attrs" v-on="on">
														<v-icon dark>mdi-help</v-icon>
													</v-btn>
												</template>
												<span>Override interval for {{store.name}}</span>
											</v-tooltip>
										</div>
										<div v-if="store.on" class="mt-0" style="display: flex; align-items: center; justify-content: center;">
											<div style="max-width: 10%" class="ml-4 mr-4">
												<v-text-field v-model="store.value" single-line type="number" :rules="[interval_value_rule]" @change="updateStoreIntervals" dense solo />
											</div>
											<div style="max-width: 15%">
												<v-select :items="interval_units" v-model="store.unit" @change="updateStoreIntervals" dense solo></v-select>
											</div>
										</div>
                                    </div>
                                </div>

                                <!--  Amazon HTML  -->
                                <div v-if="has_amazon">
                                    <v-divider inset></v-divider>
									<p style="font-size: 1.075rem!important;" class="text-button ma-4 mt-3 text-center">Amazon Settings</p>

                                    <!--  Amazon Merchant HTML  -->
                                    <div style="display: flex; align-items: center; justify-content: center;">
                                        <p class="text-overline mb-5" style="font-size: 1rem!important;">Region</p>
                                        <div style="width: 20%;" class="ml-4 mr-4">
                                            <v-select :items="Object.keys(amazon_merchants)" v-model="amazon_merchant_id" @change="updateAmazonMerchant" dense solo></v-select>
                                        </div>
                                        <v-tooltip bottom>
                                            <template v-slot:activator="{ on, attrs }">
                                                <v-btn class="ma-3 mb-9" color="primary" fab x-small v-bind="attrs" v-on="on">
                                                    <v-icon dark>mdi-help</v-icon>
                                                </v-btn>
                                            </template>
                                            <span>
                                                If you want to only track prices of products sold by Amazon and no third party sellers, pick your region.
                                                If you want to use a particular Merchant, choose "Custom" and type their merchant ID.
                                            </span>
                                        </v-tooltip>
                                    </div>
                                    <div v-if="amazon_merchant_id === 'Custom'" style="display: flex; align-items: center; justify-content: center;">
                                        <p class="text-overline mb-5" style="font-size: 1rem!important;">Merchant ID</p>
                                        <div style="max-width: 20%" class="ml-4 mr-4">
                                            <v-text-field v-model="custom_merchant_id" single-line type="text" @change="updateAmazonMerchant" dense solo />
                                        </div>
                                    </div>
                                </div>

                                <!--  Target HTML  -->
                                <div v-if="has_target">
                                    <v-divider inset></v-divider>
									<p style="font-size: 1.075rem!important;" class="text-button ma-4 mt-3 text-center">Target Settings</p>
                                    <div style="display: flex; align-items: center; justify-content: center;">
                                        <p class="text-overline mb-5" style="font-size: 1.1rem!important;">Zip Code</p>
                                        <div style="max-width: 8%" class="ml-4 mr-4">
                                            <v-text-field v-model="target_zip" single-line type="text" :rules="[target_zip_rule]" @change="updateTarget" dense solo />
                                        </div>
                                        <v-tooltip bottom>
                                            <template v-slot:activator="{ on, attrs }">
                                                <v-btn class="ma-3 mb-9" color="primary" fab x-small v-bind="attrs" v-on="on">
                                                    <v-icon dark>mdi-help</v-icon>
                                                </v-btn>
                                            </template>
                                            <span>Enter your zip code to search for a Target closest to you.</span>
                                        </v-tooltip>
                                    </div>
                                    <div style="display: flex; align-items: center; justify-content: center;">
                                        <p class="text-overline mb-5" style="font-size: 1.1rem!important;">API Key</p>
                                        <div style="max-width: 84%; width: 50%;" class="ml-4 mr-4">
                                            <v-text-field v-model="target_key" single-line type="text" @change="updateTarget" dense solo />
                                        </div>
                                        <v-btn small color="primary" class="ma-2 mb-8 white--text" @click="resetTargetKey">
                                            Reset
                                            <v-icon right dark>
                                                mdi-undo-variant
                                            </v-icon>
                                        </v-btn>
                                        <v-tooltip bottom>
                                            <template v-slot:activator="{ on, attrs }">
                                                <v-btn class="ma-3 mb-9" color="primary" fab x-small v-bind="attrs" v-on="on">
                                                    <v-icon dark>mdi-help</v-icon>
                                                </v-btn>
                                            </template>
                                            <span>IF you get API key errors, enter the key for your session as described in the README.</span>
                                        </v-tooltip>
                                    </div>
                                </div>

                            </div>`,
			});

			/*
                Designed and coded by:
                Prabhjot "Prince" Singh
                https://github.com/Prince25/StockAlertBot
            */

			/*
                Optional Component
                optional, email, webhooks, webhook-item, add-webhook, sms, aws-sms, email-sms, twilio-sms
            */
			Vue.component("optional", {
				props: ["user_settings", "env_settings"],
				data: function () {
					return {
						email: this.user_settings.EMAIL,
						email_color: this.user_settings.EMAIL
							? "green--text mb-0 ml-4"
							: "red--text mb-0 ml-4",
						email_text_style: " mb-0 ml-4",
						webhook_expanded: this.user_settings.WEBHOOK_URLS.length > 0,
						sms_expanded: this.user_settings.SMS_METHOD != "None",
					};
				},

				methods: {
					toggleEmail() {
						this.email_color = this.email ? "green--text" : "red--text";
						this.email_color += this.email_text_style;
						this.$emit("toggle_email", this.email);
					},
					toggleWebhooks() {
						this.webhook_expanded = !this.webhook_expanded;
					},
					toggleSMS() {
						this.sms_expanded = !this.sms_expanded;
					},
				},

				template: `<div style="display: flex; flex-direction: column; align-items: center;">
								<p style="font-size: 1.075rem!important;" class="text-button ma-0 mt-3 text-center">Notifications</p>
                                <v-divider inset style="width: 90%; margin-right: 80px;"></v-divider>

                                <!--  Webhook HTML  -->
                                <v-btn class="mt-4 mb-8" color="primary" @click="toggleWebhooks">
                                    Webhooks
                                    <v-icon right>
                                        {{this.webhook_expanded ? "mdi-minus" : "mdi-plus" }}
                                    </v-icon>
                                </v-btn>

                                <div style="width: 100%;" class="mb-4" v-if="webhook_expanded">
                                    <webhooks
                                        v-bind:webhook_urls="user_settings.WEBHOOK_URLS"
                                        v-on:remove_webhook_url="$emit('remove_webhook_url', $event)"
                                        v-on:add_webhook_url="$emit('add_webhook_url', $event)"
                                    />
                                </div>

                                <!--  SMS HTML  -->
                                <v-divider inset style="width: 50%; margin-right: 80px;"></v-divider>
                                <v-btn class="mt-6 mb-8" color="primary" @click="toggleSMS">
                                    SMS
                                    <v-icon right>
                                        {{this.sms_expanded ? "mdi-minus" : "mdi-plus" }}
                                    </v-icon>
                                </v-btn>

                                <div style="width: 100%;" class="mb-4" v-if="sms_expanded">
                                    <sms
                                        v-bind:user_settings="user_settings"
                                        v-bind:env_settings="env_settings"
                                        v-on:update_method="$emit('update_sms_method', $event)"
                                        v-on:update_aws_region="$emit('update_sms_aws_region', $event)"
                                        v-on:update_aws_key="$emit('update_sms_aws_key', $event)"
                                        v-on:update_aws_secret="$emit('update_sms_aws_secret', $event)"
                                        v-on:update_aws_phone="$emit('update_sms_aws_phone', $event)"
                                        v-on:update_service="$emit('update_sms_email_service', $event)"
                                        v-on:update_from="$emit('update_sms_email_from', $event)"
                                        v-on:update_pass="$emit('update_sms_email_pass', $event)"
                                        v-on:update_carrier="$emit('update_sms_email_carrier', $event)"
                                        v-on:update_phone="$emit('update_sms_email_phone', $event)"
                                        v-on:update_twilio_sid="$emit('update_sms_twilio_sid', $event)"
                                        v-on:update_twilio_auth="$emit('update_sms_twilio_auth', $event)"
                                        v-on:update_twilio_from="$emit('update_sms_twilio_from', $event)"
                                        v-on:update_twilio_to="$emit('update_sms_twilio_to', $event)"
                                    />
                                </div>

                                <!--  Emails HTML  -->
                                <v-divider inset style="width: 50%; margin-right: 80px;"></v-divider>
                                <div class="mt-3" style="display: flex;align-items: center;">
                                    <v-switch v-model="email" @change="toggleEmail" inset label="Emails:" ></v-switch>
                                    <p id="email_val" :class="this.email_color">{{this.email ? "ON" : "OFF"}}</p>
                                </div>

                                <div v-if="email" style="width: 100%;">
                                    <email
                                        v-bind:settings="env_settings"
                                        v-on:update_service="$emit('update_email_service', $event)"
                                        v-on:update_from="$emit('update_email_from', $event)"
                                        v-on:update_pass="$emit('update_email_pass', $event)"
                                        v-on:update_to="$emit('update_email_to', $event)"
                                        class="ma-4"
                                    />
                                </div>

                            </div>`,
			});

			Vue.component("email", {
				props: ["settings"],
				data: function () {
					return {
						service: this.settings.EMAIL_SERVICE,
						from: this.settings.EMAIL_FROM,
						pass: this.settings.EMAIL_PASS,
						to: this.settings.EMAIL_TO,
						showPass: false,
						sameAsFromChecked: true,
						providers: [
							"Gmail",
							"Yahoo",
							"iCloud",
							"Hotmail",
							"Outlook365",
							"QQ",
							"126",
							"163",
							"1und1",
							"AOL",
							"DebugMail",
							"DynectEmail",
							"FastMail",
							"GandiMail",
							"Godaddy",
							"GodaddyAsia",
							"GodaddyEurope",
							"hot.ee",
							"mail.ee",
							"Mail.ru",
							"Maildev",
							"Mailgun",
							"Mailjet",
							"Mailosaur",
							"Mandrill",
							"Naver",
							"OpenMailBox",
							"Postmark",
							"QQex",
							"SendCloud",
							"SendGrid",
							"SendinBlue",
							"SendPulse",
							"SES",
							"SES-US-EAST-1",
							"SES-US-WEST-2",
							"SES-EU-WEST-1",
							"Sparkpost",
							"Yandex",
							"Zoho",
							"qiye.aliyun",
						],
					};
				},

				methods: {
					updateService() {
						this.$emit("update_service", this.service);
					},

					updateFrom() {
						if (this.sameAsFromChecked) {
							this.to = this.from;
							this.updateTo();
						}
						this.$emit("update_from", this.from);
					},

					updatePass() {
						this.$emit("update_pass", this.pass);
					},

					updateTo() {
						this.$emit("update_to", this.to);
					},

					updateToFromFrom() {
						if (this.sameAsFromChecked) this.to = this.from;
						else this.to = "";
						this.updateTo();
					},
				},

				template: `<div style="margin: 0px !important">

                                <!--  Service HTML  -->
                                <div style="display: flex; align-items: center; justify-content: center;">
                                    <p class="text-overline mb-5" style="font-size: 1rem!important;">Email Provider</p>
                                    <div style="width: 20%;" class="ml-4 mr-4">
                                        <v-select :items="providers" v-model="service" @change="updateService" dense solo></v-select>
                                    </div>
                                </div>

                                <!--  From HTML  -->
                                <div style="display: flex; align-items: center; justify-content: center;">
                                    <p class="text-overline mb-5" style="font-size: 1rem!important;">From Email</p>
                                    <div style="width: 34%;" class="ml-4 mr-4">
                                        <v-text-field v-model="from" single-line type="text" @change="updateFrom" dense solo clearable />
                                    </div>
                                    <v-tooltip bottom>
                                        <template v-slot:activator="{ on, attrs }">
                                            <v-btn class="ma-3 mb-9" color="primary" fab x-small v-bind="attrs" v-on="on">
                                                <v-icon dark>mdi-help</v-icon>
                                            </v-btn>
                                        </template>
                                        <span>Login email. Also the email to send notification from.</span>
                                    </v-tooltip>
                                </div>

                                <!--  Pass HTML  -->
                                <div style="display: flex; align-items: center; justify-content: center;">
                                    <p class="text-overline mb-5" style="font-size: 1rem!important;">Password</p>
                                    <div style="width: 34%;" class="ml-4 mr-4">
                                        <v-text-field v-model="pass" single-line @change="updatePass" @click:append="showPass = !showPass" :type="showPass ? 'text' : 'password'" :append-icon="showPass ? 'mdi-eye' : 'mdi-eye-off'" dense solo />
                                    </div>
                                    <v-tooltip bottom>
                                        <template v-slot:activator="{ on, attrs }">
                                            <v-btn class="ma-3 mb-9" color="primary" fab x-small v-bind="attrs" v-on="on">
                                                <v-icon dark>mdi-help</v-icon>
                                            </v-btn>
                                        </template>
                                        <span>Login password.</span>
                                    </v-tooltip>
                                </div>

                                <!--  To HTML  -->
                                <div style="display: flex; align-items: center; justify-content: center;">
                                    <p class="text-overline mb-5" style="font-size: 1rem!important;">To Email</p>
                                    <div style="width: 34%;" class="ml-4 mr-4">
                                        <v-text-field v-model="to" single-line type="text" @change="updateTo" :filled="sameAsFromChecked" :disabled="sameAsFromChecked" dense solo clearable />
                                    </div>
                                    <v-checkbox class="mt-0 mr-4" label="Same as FROM" v-model="sameAsFromChecked" @change="updateToFromFrom" dense></v-checkbox>
                                    <v-tooltip bottom>
                                        <template v-slot:activator="{ on, attrs }">
                                            <v-btn class="ma-3 mb-9" color="primary" fab x-small v-bind="attrs" v-on="on">
                                                <v-icon dark>mdi-help</v-icon>
                                            </v-btn>
                                        </template>
                                        <span>Email to send stock notification to.</span>
                                    </v-tooltip>
                                </div>
                            </div>`,
			});

			Vue.component("webhooks", {
				props: ["webhook_urls"],
				template: `<div>
                                <v-row dense>
                                    <v-col v-for="(url, index) in webhook_urls" :key="index" md="6" class="ma-0 pa-3 pl-8 pr-8">
                                        <webhook-item v-bind:webhook_url="url" v-bind:key="url" v-on:remove_webhook_url="$emit('remove_webhook_url', $event)" />
                                    </v-col>
                                </v-row>
                                <div v-if="webhook_urls.length > 0">
                                    <v-divider inset class="ma-7 mb-0"></v-divider>
                                </div>
                                <add-webhook class="ma-0 pa-3" style="text-align: center;" v-on:add_webhook_url="$emit('add_webhook_url', $event)" />
                            </div>`,
			});

			Vue.component("webhook-item", {
				props: ["webhook_url"],
				methods: {
					remove() {
						this.$emit("remove_webhook_url", this.webhook_url);
					},
				},
				template: `<v-text-field
                                dense
                                solo
                                readonly
                                type="text"
                                hide-details
                                :value="webhook_url"
                                :append-outer-icon="'mdi-close'"
                                @click:append-outer="remove"
                            ></v-text-field>`,
			});

			Vue.component("add-webhook", {
				data: function () {
					return {
						webhook_url: "",
					};
				},
				methods: {
					add() {
						if (this.webhook_url) {
							this.$emit("add_webhook_url", this.webhook_url);
							this.webhook_url = "";
						}
					},
				},
				template: `<div class="ma-0 pa-0">
                                <p style="font-size: 1.075rem!important" class="text-button ma-0">Add Discord, IFTTT, or Slack Webhook</p>
                                <div class="ma-0 pa-0" style="max-width: 65%;display: flex;align-items: baseline;margin: auto !important;">
                                    <v-text-field
                                        dense
                                        solo
                                        outlined
                                        clearable
                                        hide-details
                                        clear-icon="mdi-close-circle"
                                        type="text"
                                        label="Enter Webhook URL"
                                        v-model="webhook_url"
                                        :append-outer-icon="'mdi-plus'"
                                        @click:append-outer="add"
										@keydown.enter="add"
                                    ></v-text-field>
                                    <v-tooltip bottom>
                                        <template v-slot:activator="{ on, attrs }">
                                            <v-btn class="ma-3 mb-9" color="primary" fab x-small v-bind="attrs" v-on="on">
                                                <v-icon dark>mdi-help</v-icon>
                                            </v-btn>
                                        </template>
                                        <span>Format: https://www.ABC123.com/...</span>
                                    </v-tooltip>
                                </div>
                                <p class="pa-0 ma-0" style="color: red; text-align: center;" id="add_webhook_url_error"></p>
                            </div>`,
			});

			/*
                Designed and coded by:
                Prabhjot "Prince" Singh
                https://github.com/Prince25/StockAlertBot
            */

			Vue.component("sms", {
				props: ["user_settings", "env_settings"],
				data: function () {
					return {
						method: this.user_settings.SMS_METHOD,
						methods: ["None", "Amazon Web Services", "Email", "Twilio"],
					};
				},

				methods: {
					updateMethod() {
						this.$emit("update_method", this.method);
					},
				},

				template: `<div>
                                <!--  SMS METHOD HTML  -->
                                <div style="display: flex; align-items: center; justify-content: center;">
                                    <p class="text-overline mb-5" style="font-size: 1rem!important;">SMS Method</p>
                                    <div style="width: 20%;" class="ml-4 mr-4">
                                        <v-select :items="methods" v-model="method" @change="updateMethod" dense solo></v-select>
                                    </div>
                                </div>

                                <!--  AWS SMS HTML  -->
                                <div v-if="method === 'Amazon Web Services'" style="width: 100%;">
                                    <aws-sms
                                        v-bind:settings="env_settings"
                                        v-on:update_region="$emit('update_aws_region', $event)"
                                        v-on:update_key="$emit('update_aws_key', $event)"
                                        v-on:update_secret="$emit('update_aws_secret', $event)"
                                        v-on:update_phone="$emit('update_aws_phone', $event)"
                                        class="ma-4"
                                    />
                                </div>

                                <!--  EMAIL SMS HTML  -->
                                <div v-if="method === 'Email'" style="width: 100%;">
                                    <email-sms
                                        v-bind:settings="env_settings"
                                        v-on:update_service="$emit('update_service', $event)"
                                        v-on:update_from="$emit('update_from', $event)"
                                        v-on:update_pass="$emit('update_pass', $event)"
                                        v-on:update_carrier="$emit('update_carrier', $event)"
                                        v-on:update_phone="$emit('update_phone', $event)"
                                        class="ma-4"
                                    />
                                </div>

                                <!--  TWILIO SMS HTML  -->
                                <div v-if="method === 'Twilio'" style="width: 100%;">
                                    <twilio-sms
                                        v-bind:settings="env_settings"
                                        v-on:update_sid="$emit('update_twilio_sid', $event)"
                                        v-on:update_auth="$emit('update_twilio_auth', $event)"
                                        v-on:update_from="$emit('update_twilio_from', $event)"
                                        v-on:update_to="$emit('update_twilio_to', $event)"
                                        class="ma-4"
                                    />
                                </div>
                            </div>`,
			});

			Vue.component("aws-sms", {
				props: ["settings"],
				data: function () {
					return {
						key: this.settings.SMS_AWS_ACCESS_KEY,
						secret: this.settings.SMS_AWS_SECRET_ACCESS,
						phone: this.settings.SMS_AWS_PHONE_NUMBER,
						regions: {
							// https://docs.aws.amazon.com/sns/latest/dg/sns-supported-regions-countries.html
							"US East (Ohio)": "us-east-2",
							"US East (N. Virginia)": "us-east-1",
							"US West (N. California)": "us-west-1",
							"US West (Oregon)": "us-west-2",
							"Asia Pacific (Mumbai)": "ap-south-1",
							"Asia Pacific (Singapore)": "ap-southeast-1",
							"Asia Pacific (Sydney)": "ap-southeast-2",
							"Asia Pacific (Tokyo)": "ap-northeast-1",
							"Canada (Central)": "ca-central-1",
							"Europe (Frankfurt)": "eu-central-1",
							"Europe (Ireland)": "eu-west-1",
							"Europe (London)": "eu-west-2",
							"Europe (Paris)": "eu-west-3",
							"Europe (Stockholm)": "eu-north-1",
							"Middle East (Bahrain)": "me-south-1",
							"South America (São Paulo)": "sa-east-1",
							"AWS GovCloud (US-West)": "us-gov-west-1",
						},
						region: "",
					};
				},

				mounted() {
					this.region = Object.keys(this.regions).find(
						(key) => this.regions[key] === this.settings.SMS_AWS_REGION
					);
				},

				methods: {
					updateRegion() {
						this.$emit("update_region", this.regions[this.region]);
					},
					updateKey() {
						this.$emit("update_key", this.key);
					},
					updateSecret() {
						this.$emit("update_secret", this.secret);
					},
					updatePhone() {
						this.$emit("update_phone", this.phone);
					},
				},

				template: `<div style="margin: 0px !important">

                                <!--  Region HTML  -->
                                <div style="display: flex; align-items: center; justify-content: center;">
                                    <p class="text-overline mb-5" style="font-size: 1rem!important;">Region</p>
                                    <div style="width: 25%;" class="ml-4 mr-4">
                                        <v-select :items="Object.keys(regions)" v-model="region" @change="updateRegion" dense solo></v-select>
                                    </div>
                                    <v-tooltip bottom>
                                        <template v-slot:activator="{ on, attrs }">
                                            <v-btn class="ma-3 mb-9" color="primary" fab x-small v-bind="attrs" v-on="on" href="https://docs.aws.amazon.com/sns/latest/dg/sns-supported-regions-countries.html" target="_blank">
                                                <v-icon dark>mdi-help</v-icon>
                                            </v-btn>
                                        </template>
                                        <span>Click for region information.</span>
                                    </v-tooltip>
                                </div>

                                <!--  Key HTML  -->
                                <div style="display: flex; align-items: center; justify-content: center;">
                                    <p class="text-overline mb-5" style="font-size: 1rem!important;">Access Key</p>
                                    <div style="width: 40%;" class="ml-4 mr-4">
                                        <v-text-field v-model="key" single-line type="text" @change="updateKey" dense solo clearable />
                                    </div>
                                    <v-tooltip bottom>
                                        <template v-slot:activator="{ on, attrs }">
                                            <v-btn class="ma-3 mb-9" color="primary" fab x-small v-bind="attrs" v-on="on" href="https://medium.com/codephilics/how-to-send-a-sms-using-amazon-simple-notification-service-sns-46208d82abcc" target="_blank" >
                                                <v-icon dark>mdi-help</v-icon>
                                            </v-btn>
                                        </template>
                                        <span>Click for instructions on how to obtain key.</span>
                                    </v-tooltip>
                                </div>

                                <!--  Secret HTML  -->
                                <div style="display: flex; align-items: center; justify-content: center;">
                                    <p class="text-overline mb-5" style="font-size: 1rem!important;">Secret Acesss Key</p>
                                    <div style="width: 40%;" class="ml-4 mr-4">
                                        <v-text-field v-model="secret" single-line type="text" @change="updateSecret" dense solo clearable />
                                    </div>
                                    <v-tooltip bottom>
                                        <template v-slot:activator="{ on, attrs }">
                                            <v-btn class="ma-3 mb-9" color="primary" fab x-small v-bind="attrs" v-on="on" href="https://medium.com/codephilics/how-to-send-a-sms-using-amazon-simple-notification-service-sns-46208d82abcc" target="_blank" >
                                                <v-icon dark>mdi-help</v-icon>
                                            </v-btn>
                                        </template>
                                        <span>Click for instructions on how to obtain key.</span>
                                    </v-tooltip>
                                </div>

                                <!--  Phone HTML  -->
                                <div style="display: flex; align-items: center; justify-content: center;">
                                    <p class="text-overline mb-5" style="font-size: 1rem!important;">Phone Number</p>
                                    <div style="width: 15%;" class="ml-4 mr-4">
                                        <v-text-field class="phoneNumber" v-model="phone" single-line type="number" @change="updatePhone" placeholder="1 999 999 999" dense solo clearable />
                                    </div>
                                    <v-tooltip bottom>
                                        <template v-slot:activator="{ on, attrs }">
                                            <v-btn class="ma-3 mb-9" color="primary" fab x-small v-bind="attrs" v-on="on" href="https://countrycode.org/" target="_blank" >
                                                <v-icon dark>mdi-help</v-icon>
                                            </v-btn>
                                        </template>
                                        <span>Include country and area code (just digits, no special characters). Click for country codes.</span>
                                    </v-tooltip>
                                </div>
                            </div>`,
			});

			Vue.component("email-sms", {
				props: ["settings"],
				data: function () {
					return {
						service: this.settings.SMS_EMAIL_SERVICE,
						from: this.settings.SMS_EMAIL_FROM,
						pass: this.settings.SMS_EMAIL_PASS,
						carrier: "",
						phone: this.settings.SMS_EMAIL_PHONE_NUMBER,
						showPass: false,
						providers: [
							"Gmail",
							"Yahoo",
							"iCloud",
							"Hotmail",
							"Outlook365",
							"QQ",
							"126",
							"163",
							"1und1",
							"AOL",
							"DebugMail",
							"DynectEmail",
							"FastMail",
							"GandiMail",
							"Godaddy",
							"GodaddyAsia",
							"GodaddyEurope",
							"hot.ee",
							"mail.ee",
							"Mail.ru",
							"Maildev",
							"Mailgun",
							"Mailjet",
							"Mailosaur",
							"Mandrill",
							"Naver",
							"OpenMailBox",
							"Postmark",
							"QQex",
							"SendCloud",
							"SendGrid",
							"SendinBlue",
							"SendPulse",
							"SES",
							"SES-US-EAST-1",
							"SES-US-WEST-2",
							"SES-EU-WEST-1",
							"Sparkpost",
							"Yandex",
							"Zoho",
							"qiye.aliyun",
						],
						carriers: {
							"Alltel": "sms.alltelwireless.com",
							"AT&T / FirstNet": "txt.att.net",
							"AT&T MMS": "mms.att.net",
							"Boost Mobile": "sms.myboostmobile.com",
							"Boost Mobile MMS": "myboostmobile.com",
							"Cricket Wireless": "sms.cricketwireless.net",
							"Cricket Wireless MMS": "mms.cricketwireless.net",
							"EE": "mms.ee.co.uk",
							"Google Fi SMS & MMS": "msg.fi.google.com",
							"MetroPCS SMS & MMS": "mymetropcs.com",
							"O2": "mmail.co.uk",
							"Republic Wireless": "text.republicwireless.com",
							"Sprint": "messaging.sprintpcs.com",
							"Sprint MMS": "pm.sprint.com",
							"T-Mobile SMS & MMS": "tmomail.net",
							"Ting": "message.ting.com",
							"U.S. Cellular": "email.uscc.net",
							"U.S. Cellular MMS": "mms.uscc.net",
							"Verizon Wireless / Straight Talk / Xfinity Mobile": "vtext.com",
							"Verizon Wireless MMS": "vzwpix.com",
							"Virgin Mobile": "vmobl.com",
							"Vodafone": "vodafone.net",
              "Xfinity Mobile MMS / Virgin Mobile MMS": "mypixmessages.com",
						},
					};
				},

				mounted() {
					this.carrier = Object.keys(this.carriers).find(
						(key) => this.carriers[key] === this.settings.SMS_EMAIL_PHONE_CARRIER
					);
				},

				methods: {
					updateService() {
						this.$emit("update_service", this.service);
					},
					updateFrom() {
						this.$emit("update_from", this.from);
					},
					updatePass() {
						this.$emit("update_pass", this.pass);
					},
					updateCarrier() {
						this.$emit("update_carrier", this.carriers[this.carrier]);
					},
					updatePhone() {
						this.$emit("update_phone", this.phone);
					},
				},

				template: `<div style="margin: 0px !important">

                                <!--  Service HTML  -->
                                <div style="display: flex; align-items: center; justify-content: center;">
                                    <p class="text-overline mb-5" style="font-size: 1rem!important;">Email Provider</p>
                                    <div style="width: 20%;" class="ml-4 mr-4">
                                        <v-select :items="providers" v-model="service" @change="updateService" dense solo></v-select>
                                    </div>
                                </div>

                                <!--  From HTML  -->
                                <div style="display: flex; align-items: center; justify-content: center;">
                                    <p class="text-overline mb-5" style="font-size: 1rem!important;">Email Address</p>
                                    <div style="width: 34%;" class="ml-4 mr-4">
                                        <v-text-field v-model="from" single-line type="text" @change="updateFrom" dense solo clearable />
                                    </div>
                                    <v-tooltip bottom>
                                        <template v-slot:activator="{ on, attrs }">
                                            <v-btn class="ma-3 mb-9" color="primary" fab x-small v-bind="attrs" v-on="on">
                                                <v-icon dark>mdi-help</v-icon>
                                            </v-btn>
                                        </template>
                                        <span>Login email. Also the email to send notification from.</span>
                                    </v-tooltip>
                                </div>

                                <!--  Pass HTML  -->
                                <div style="display: flex; align-items: center; justify-content: center;">
                                    <p class="text-overline mb-5" style="font-size: 1rem!important;">Password</p>
                                    <div style="width: 34%;" class="ml-4 mr-4">
                                        <v-text-field v-model="pass" single-line @change="updatePass" @click:append="showPass = !showPass" :type="showPass ? 'text' : 'password'" :append-icon="showPass ? 'mdi-eye' : 'mdi-eye-off'" dense solo />
                                    </div>
                                    <v-tooltip bottom>
                                        <template v-slot:activator="{ on, attrs }">
                                            <v-btn class="ma-3 mb-9" color="primary" fab x-small v-bind="attrs" v-on="on">
                                                <v-icon dark>mdi-help</v-icon>
                                            </v-btn>
                                        </template>
                                        <span>Login password.</span>
                                    </v-tooltip>
                                </div>

                                <!--  Carrier HTML  -->
                                <div style="display: flex; align-items: center; justify-content: center;">
                                    <p class="text-overline mb-5" style="font-size: 1rem!important;">Phone Carrier</p>
                                    <div style="width: 20%;" class="ml-4 mr-4">
                                        <v-select :items="Object.keys(carriers)" v-model="carrier" @change="updateCarrier" dense solo></v-select>
                                    </div>
                                    <v-tooltip bottom>
                                        <template v-slot:activator="{ on, attrs }">
                                            <v-btn class="ma-3 mb-9" color="primary" fab x-small v-bind="attrs" v-on="on" >
                                                <v-icon dark>mdi-help</v-icon>
                                            </v-btn>
                                        </template>
                                        <span>Carrier of the phone number. Default sending is SMS, some carriers support MMS as well, individual carrier rates may apply.</span>
                                    </v-tooltip>
                                </div>

                                <!--  Phone HTML  -->
                                <div style="display: flex; align-items: center; justify-content: center;">
                                    <p class="text-overline mb-5" style="font-size: 1rem!important;">Phone Number</p>
                                    <div style="width: 15%;" class="ml-4 mr-4">
                                        <v-text-field class="phoneNumber" v-model="phone" single-line type="number" @change="updatePhone" placeholder="999 999 999" dense solo clearable />
                                    </div>
                                    <v-tooltip bottom>
                                        <template v-slot:activator="{ on, attrs }">
                                            <v-btn class="ma-3 mb-9" color="primary" fab x-small v-bind="attrs" v-on="on" >
                                                <v-icon dark>mdi-help</v-icon>
                                            </v-btn>
                                        </template>
                                        <span>Include area code (just digits, no special characters).</span>
                                    </v-tooltip>
                                </div>
                            </div>`,
			});

			Vue.component("twilio-sms", {
				props: ["settings"],
				data: function () {
					return {
						sid: this.settings.SMS_TWILIO_ACCOUNT_SID,
						auth: this.settings.SMS_TWILIO_AUTH_TOKEN,
						from: this.settings.SMS_TWILIO_FROM_NUMBER,
						to: this.settings.SMS_TWILIO_TO_NUMBER,
					};
				},

				methods: {
					updateSID() {
						this.$emit("update_sid", this.sid);
					},
					updateAuth() {
						this.$emit("update_auth", this.auth);
					},
					updateFrom() {
						this.$emit("update_from", this.from);
					},
					updateTo() {
						this.$emit("update_to", this.to);
					},
				},

				template: `<div style="margin: 0px !important">

                                <!--  SID HTML  -->
                                <div style="display: flex; align-items: center; justify-content: center;">
                                    <p class="text-overline mb-5" style="font-size: 1rem!important;">Account SID</p>
                                    <div style="width: 40%;" class="ml-4 mr-4">
                                        <v-text-field v-model="sid" single-line type="text" @change="updateSID" dense solo clearable />
                                    </div>
                                    <v-tooltip bottom>
                                        <template v-slot:activator="{ on, attrs }">
                                            <v-btn class="ma-3 mb-9" color="primary" fab x-small v-bind="attrs" v-on="on" href="https://www.twilio.com/console" target="_blank" >
                                                <v-icon dark>mdi-help</v-icon>
                                            </v-btn>
                                        </template>
                                        <span>Twilio account SID. Click to go to Twilio Console.</span>
                                    </v-tooltip>
                                </div>

                                <!--  Auth HTML  -->
                                <div style="display: flex; align-items: center; justify-content: center;">
                                    <p class="text-overline mb-5" style="font-size: 1rem!important;">Auth Token</p>
                                    <div style="width: 40%;" class="ml-4 mr-4">
                                        <v-text-field v-model="auth" single-line type="text" @change="updateAuth" dense solo clearable />
                                    </div>
                                    <v-tooltip bottom>
                                        <template v-slot:activator="{ on, attrs }">
                                            <v-btn class="ma-3 mb-9" color="primary" fab x-small v-bind="attrs" v-on="on" href="https://www.twilio.com/console" target="_blank" >
                                                <v-icon dark>mdi-help</v-icon>
                                            </v-btn>
                                        </template>
                                        <span>Twilio auth token. Click to go to Twilio Console.</span>
                                    </v-tooltip>
                                </div>

                                <!--  From HTML  -->
                                <div style="display: flex; align-items: center; justify-content: center;">
                                    <p class="text-overline mb-5" style="font-size: 1rem!important;">Twilio Number</p>
                                    <div style="width: 15%;" class="ml-4 mr-4">
                                        <v-text-field class="phoneNumber" v-model="from" single-line type="number" @change="updateFrom" placeholder="1 999 999 999" dense solo clearable />
                                    </div>
                                    <v-tooltip bottom>
                                        <template v-slot:activator="{ on, attrs }">
                                            <v-btn class="ma-3 mb-9" color="primary" fab x-small v-bind="attrs" v-on="on" href="https://www.twilio.com/console/phone-numbers" target="_blank" >
                                                <v-icon dark>mdi-help</v-icon>
                                            </v-btn>
                                        </template>
                                        <span>Twilio phone number. Include country and area code (just digits, no special characters). Click to go to Twilio Console.</span>
                                    </v-tooltip>
                                </div>

                                <!--  To HTML  -->
                                <div style="display: flex; align-items: center; justify-content: center;">
                                    <p class="text-overline mb-5" style="font-size: 1rem!important;">Phone Number</p>
                                    <div style="width: 15%;" class="ml-4 mr-4">
                                        <v-text-field class="phoneNumber" v-model="to" single-line type="number" @change="updateTo" placeholder="1 999 999 999" dense solo clearable />
                                    </div>
                                    <v-tooltip bottom>
                                        <template v-slot:activator="{ on, attrs }">
                                            <v-btn class="ma-3 mb-9" color="primary" fab x-small v-bind="attrs" v-on="on" href="https://countrycode.org/" target="_blank" >
                                                <v-icon dark>mdi-help</v-icon>
                                            </v-btn>
                                        </template>
                                        <span>Include country and area code (just digits, no special characters). Click for country codes.</span>
                                    </v-tooltip>
                                </div>
                            </div>`,
			});

			/*
                Main Component
            */
			const SERVER_ENDPOINT = "http://localhost:3250";
			const app = new Vue({
				el: "#app",
				vuetify: new Vuetify(),

				data: function () {
					return {
						current_tab: null,
						tabs: ["URLs", "Settings", "Optional", "DEBUG"],
						userSettings: {},
						envSettings: {},
						stores: new Set(),
						has_amazon: false,
						has_target: false,
						disableSaveButton: false,
					};
				},

				computed: {
					// Disable Save Button if email is on or SMS method is chosen, but information is not provided
					checkSaveButton: function () {
						let error_message = "";

						// Check Email
						let email_invalid =
							this.userSettings.EMAIL &&
							(!this.envSettings.EMAIL_SERVICE ||
								!this.envSettings.EMAIL_FROM ||
								!this.envSettings.EMAIL_PASS ||
								!this.envSettings.EMAIL_TO);

						// Check
						let sms_invalid = false;
						switch (this.userSettings.SMS_METHOD) {
							case "Amazon Web Services":
								if (
									!this.envSettings.SMS_AWS_REGION ||
									!this.envSettings.SMS_AWS_ACCESS_KEY ||
									!this.envSettings.SMS_AWS_SECRET_ACCESS ||
									!this.envSettings.SMS_AWS_PHONE_NUMBER
								)
									sms_invalid = true;
								break;

							case "Email":
								if (
									!this.envSettings.SMS_EMAIL_SERVICE ||
									!this.envSettings.SMS_EMAIL_FROM ||
									!this.envSettings.SMS_EMAIL_PASS ||
									!this.envSettings.SMS_EMAIL_PHONE_CARRIER ||
									!this.envSettings.SMS_EMAIL_PHONE_NUMBER
								)
									sms_invalid = true;
								break;

							case "Twilio":
								if (
									!this.envSettings.SMS_TWILIO_ACCOUNT_SID ||
									!this.envSettings.SMS_TWILIO_AUTH_TOKEN ||
									!this.envSettings.SMS_TWILIO_FROM_NUMBER ||
									!this.envSettings.SMS_TWILIO_TO_NUMBER
								)
									sms_invalid = true;
								break;
						}

						// Update Message
						if (email_invalid && sms_invalid)
							error_message = "Error: Email & SMS information not provided.";
						else if (email_invalid)
							error_message = "Error: Email information not provided.";
						else if (sms_invalid)
							error_message = "Error: SMS information not provided.";

						// Disable Button, Display Error Message
						this.disableSaveButton = email_invalid || sms_invalid;
						if (this.disableSaveButton)
							document.getElementById(
								"save_button_error"
							).textContent = error_message;
						else document.getElementById("save_button_error").textContent = "";

						return this.disableSaveButton;
					},

					// Gets all the store names provided in the URLs
					getStoreNames: function () {
						if (this.userSettings.URLS && this.userSettings.URLS.length > 0) {
							this.stores = new Set();
							this.userSettings.URLS.forEach((url) => {
								const storeName = this.getDomainName(url);
								this.stores.add(storeName);
							});
							return [...this.stores];
						} else {
							this.stores = new Set();
							return [];
						}
					},
				},

				methods: {
					// Gets the domain from an URL
					getDomainName(url) {
						let hostName = new URL(url).hostname;
						let host = hostName.split(".");
						return host[1];
					},

					// Check for valid URLs
					isValidHttpUrl(string) {
						let url;
						try {
							url = new URL(string);
						} catch (_) {
							return false;
						}
						return url.protocol === "http:" || url.protocol === "https:";
					},

					// Add an URL
					addURL(urlToAdd) {
						if (this.isValidHttpUrl(urlToAdd)) {
							let storeName = this.getDomainName(urlToAdd);
							if (this.userSettings.SUPPORTED_STORES_DOMAINS.includes(storeName))
								if (!this.userSettings.URLS.includes(urlToAdd)) {
									this.userSettings.URLS.push(urlToAdd);
									document.getElementById("add_url_error").textContent = "";

									// Check for Amazon or Target linnks
									if (!this.has_amazon || !this.has_target) {
										if (storeName == "amazon") this.has_amazon = true;
										if (storeName == "target") this.has_target = true;
									}
								} else
									document.getElementById("add_url_error").textContent =
										"Error: URL already included.";
							else
								document.getElementById("add_url_error").textContent =
									"Error: Store currently not supported.";
						} else
							document.getElementById("add_url_error").textContent =
								"Error: Invalid URL format.";
					},

					// Removes an URL
					removeURL(urlToRemove) {
						this.userSettings.URLS = this.userSettings.URLS.filter(
							(url) => url !== urlToRemove
						);

						// Check for Amazon URL
						if (
							!this.userSettings.URLS.some(
								(url) => this.getDomainName(url) == "amazon"
							)
						)
							this.has_amazon = false;

						// Check for Target URL
						if (
							!this.userSettings.URLS.some(
								(url) => this.getDomainName(url) == "target"
							)
						)
							this.has_target = false;
					},

					// Update check interval
					updateInterval(interval) {
						this.userSettings.INTERVAL.unit = interval.unit;
						this.userSettings.INTERVAL.value = interval.value;
					},

					// Update Delay
					updateDelay(delay) {
						this.userSettings.TIME_BETWEEN_CHECKS.unit = delay.unit;
						this.userSettings.TIME_BETWEEN_CHECKS.value = delay.value;
					},

					// Update open URL boolean
					updateOpenURL(boolean) {
						this.userSettings.OPEN_URL = boolean;
					},

					// Update Desktop boolean
					updateDesktop(boolean) {
						this.userSettings.DESKTOP = boolean;
					},

					// Update proxies boolean
					updateProxies(boolean) {
						this.userSettings.PROXIES = boolean;
					},

					// Update store intervals
					updateStoreIntervals(store_intervals) {
						this.userSettings.STORE_INTERVALS = {};
						store_intervals.forEach((store) => {
							if (store.on && this.stores.has(store.name)) {
								this.userSettings.STORE_INTERVALS[store.name] = {
									unit: store.unit,
									value: store.value,
								};
							}
						});
					},

					// Update Amazon Merchant
					updateAmazonMerchant(merchant_id) {
						this.userSettings.AMAZON_MERCHANT_ID = merchant_id;
					},

					// Update Target settings
					updateTarget(target_info) {
						this.userSettings.TARGET_ZIP_CODE = target_info.zip;
						this.userSettings.TARGET_KEY = target_info.key;
					},

					// Add a webhook URL
					addWebhookURL(urlToAdd) {
						if (this.isValidHttpUrl(urlToAdd)) {
							if (
								this.userSettings.SUPPORTED_WEBHOOK_DOMAINS.some((webhookDomain) =>
									urlToAdd.includes(webhookDomain)
								)
							) {
								if (!this.userSettings.WEBHOOK_URLS.includes(urlToAdd)) {
									this.userSettings.WEBHOOK_URLS.push(urlToAdd);
									document.getElementById("add_webhook_url_error").textContent =
										"";
								} else
									document.getElementById("add_webhook_url_error").textContent =
										"Error: URL already included.";
							} else
								document.getElementById("add_webhook_url_error").textContent =
									"Error: Webhook currently not supported.";
						} else
							document.getElementById("add_webhook_url_error").textContent =
								"Error: Invalid URL format.";
					},

					// Removes a webhook URL
					removeWebhookURL(urlToRemove) {
						this.userSettings.WEBHOOK_URLS = this.userSettings.WEBHOOK_URLS.filter(
							(url) => url !== urlToRemove
						);
					},

					// Update SMS Method
					updateSMSMethod(method) {
						this.userSettings.SMS_METHOD = method;
					},

					// Update AWS Region
					updateAWSRegion(region) {
						this.envSettings.SMS_AWS_REGION = region;
					},

					// Update AWS Key
					updateAWSKey(key) {
						this.envSettings.SMS_AWS_ACCESS_KEY = key;
					},

					// Update AWS Secret
					updateAWSSecret(secret) {
						this.envSettings.SMS_AWS_SECRET_ACCESS = secret;
					},

					// Update AWS Phone
					updateAWSPhone(phone) {
						this.envSettings.SMS_AWS_PHONE_NUMBER = phone;
					},

					// Update SMS Email service provider
					updateSMSEmailService(provider) {
						this.envSettings.SMS_EMAIL_SERVICE = provider;
					},

					// Update SMS Email from
					updateSMSEmailFrom(from) {
						this.envSettings.SMS_EMAIL_FROM = from;
					},

					// Update SMS Email password
					updateSMSEmailPass(pass) {
						this.envSettings.SMS_EMAIL_PASS = pass;
					},

					// Update SMS Email Carrier
					updateSMSEmailCarrier(carrier) {
						this.envSettings.SMS_EMAIL_PHONE_CARRIER = carrier;
					},

					// Update SMS Email Phone
					updateSMSEmailPhone(phone) {
						this.envSettings.SMS_EMAIL_PHONE_NUMBER = phone;
					},

					// Update SMS Twilio SID
					updateSMSTwilioSID(sid) {
						this.envSettings.SMS_TWILIO_ACCOUNT_SID = sid;
					},

					// Update SMS Twilio Auth
					updateSMSTwilioAuth(auth) {
						this.envSettings.SMS_TWILIO_AUTH_TOKEN = auth;
					},

					// Update SMS Twilio From
					updateSMSTwilioFrom(from) {
						this.envSettings.SMS_TWILIO_FROM_NUMBER = from;
					},

					// Update SMS Twilio To
					updateSMSTwilioTo(to) {
						this.envSettings.SMS_TWILIO_TO_NUMBER = to;
					},

					// Set Email Value
					setEmail(value) {
						this.userSettings.EMAIL = value;
					},

					// Update service provider
					updateEmailService(provider) {
						this.envSettings.EMAIL_SERVICE = provider;
					},

					// Update from email
					updateEmailFrom(from) {
						this.envSettings.EMAIL_FROM = from;
					},

					// Update email password
					updateEmailPass(pass) {
						this.envSettings.EMAIL_PASS = pass;
					},

					// Update to email
					updateEmailTo(to) {
						this.envSettings.EMAIL_TO = to;
					},

					// Send settings via a POST request to be saved
					sendSettings() {
						axios
							.post(SERVER_ENDPOINT + "/config", this.userSettings)
							.then(function (response) {
								console.log("User settings successfully written!", response);
							})
							.catch(function (error) {
								// Handle error
								console.log("Error writing user settings", error);
							});

						axios
							.post(SERVER_ENDPOINT + "/env", this.envSettings)
							.then(function (response) {
								console.log(".env settings successfully written!", response);
							})
							.catch(function (error) {
								// Handle error
								console.log("Error writing .env settings", error);
							});
					},
				},

				mounted() {
					// Get settings already saved in file
					axios
						.get(SERVER_ENDPOINT + "/config")
						.then((res) => {
							this.userSettings = res.data;
							console.log("User settings successfully fetched!");

							// Check for Amazon URL
							if (
								this.userSettings.URLS.some(
									(url) => this.getDomainName(url) == "amazon"
								)
							)
								this.has_amazon = true;

							// Check for Target URL
							if (
								this.userSettings.URLS.some(
									(url) => this.getDomainName(url) == "target"
								)
							)
								this.has_target = true;
						})
						.catch(function (error) {
							// Handle error
							console.log("Error fetching user settings", error);
						});

					// Get .env data
					axios
						.get(SERVER_ENDPOINT + "/env")
						.then((res) => {
							this.envSettings = res.data;
							console.log(".env settings successfully fetched!");
						})
						.catch(function (error) {
							// Handle error
							console.log("Error fetching .env settings", error);
						});
				},
			});
		</script>
	</body>
</html>
